---
title: "batchr-demo"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{batchr-demo}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Demonstration

For the purposes of this demonstration let's create a temporary directory
with two csv files.

```{r}
path <- file.path(tempdir(), "demo")
unlink(path)
dir.create(path)

write.csv(data.frame(x = 1), file.path(path, "file1.csv"))
write.csv(data.frame(x = 3), file.path(path, "file2.csv"))
```

### Configuration

The first task is for the user to configure a directory by specify the files to process and the function to process them with.
```{r}
library(batchr)

fun <- function(file) {
  data <- read.csv(file)
  data$y <- data$x * 2
  write.csv(data, file)
  TRUE
}

batch_config(fun, path = path, pattern = "^file\\d[.]csv$")
```

Configuring a directory creates a hidden file (``r batch_config_files(path)``) which can be read using `batch_read_config()`
```{r}
batch_config_files(path) # hidden file
batch_read_config(path)
```
The `time` value specifies the system time (in UTC) that the project was configured.
A file is only treated as unprocessed if the time it was last modified is *before* the time of configuration 
If a file is successfully processed its modification time is set to the current time; otherwise the name of the file is logged in the `.batchr.log` file.

### Start

The next task is to start (or restart) processing the files using `batch_start()`.
```{r}
batch_run(path, ask = FALSE)
```
